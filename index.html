<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Proje Hikayeleri Anketi</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 15px;
      line-height: 1.6;
      color: #333;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: rgba(255,255,255,0.98);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.15);
    }
    .header {
      text-align: center;
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 3px solid #3498db;
    }
    .header h1 { color: #2c3e50; font-size: 1.6em; margin-bottom: 10px; font-weight: 700; }
    .header p { color: #7f8c8d; font-size: 0.95em; margin-bottom: 12px; }
    .time-indicator {
      background: linear-gradient(45deg, #27ae60, #2ecc71);
      color: white;
      padding: 10px 20px;
      border-radius: 25px;
      font-size: 0.9em;
      font-weight: bold;
      display: inline-block;
      box-shadow: 0 4px 15px rgba(39,174,96,0.3);
    }

    /* Progress Indicator */
    .progress-container { margin: 20px 0; text-align: center; }
    .progress-bar-wrapper { background: #ecf0f1; height: 8px; border-radius: 20px; overflow: hidden; margin: 15px 0; position: relative; }
    .progress-bar { background: linear-gradient(90deg, #3498db, #2ecc71, #f39c12, #e74c3c); height: 100%; border-radius: 20px; transition: width 0.5s ease; width: 0%; }
    .progress-steps { display: flex; justify-content: space-between; margin-top: 10px; font-size: 0.8em; }
    .progress-step { padding: 5px 10px; border-radius: 15px; font-weight: 600; color: #95a5a6; background: #ecf0f1; min-width: 60px; text-align: center; }
    .progress-step.completed { background: #27ae60; color: white; }
    .progress-step.active { background: #3498db; color: white; animation: pulse 2s infinite; }
    @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(52, 152, 219, 0); } 100% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0); } }

    /* Gamification */
    .achievement-panel { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 15px 20px; border-radius: 15px; margin: 20px 0; text-align: center; }
    .achievement-score { font-size: 1.5em; font-weight: bold; margin-bottom: 10px; }
    .achievement-badges { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
    .badge { background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); border: 2px solid transparent; padding: 8px 12px; border-radius: 20px; font-size: 0.9em; font-weight: bold; transition: all 0.3s ease; }
    .badge.earned { background: rgba(255,255,255,0.9); color: #2c3e50; border-color: #f39c12; box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3); animation: bounce 0.6s ease-in-out; }
    @keyframes bounce { 0%, 60%, 75%, 90%, 100% { transform: translateY(0); } 15% { transform: translateY(-10px); } 30% { transform: translateY(-5px); } 45% { transform: translateY(-2px); } }
    .story-quality-indicator { background: #e8f4fd; border-left: 4px solid #3498db; padding: 10px 15px; margin-top: 10px; border-radius: 0 8px 8px 0; font-size: 0.9em; display: none; }
    .quality-score { font-weight: bold; color: #2980b9; }
    .encouragement-message { background: linear-gradient(45deg, #f39c12, #f1c40f); color: white; padding: 10px 15px; border-radius: 20px; margin: 15px 0; text-align: center; font-weight: bold; display: none; animation: slideDown 0.5s ease-out; }
    @keyframes slideDown { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .multi-submission-note { background: #e8f4fd; border-left: 4px solid #3498db; padding: 12px 16px; margin-bottom: 20px; border-radius: 0 8px 8px 0; font-size: 0.9em; }
    .section { margin-bottom: 30px; background: #f8f9fa; border-radius: 16px; padding: 25px; border-left: 5px solid #3498db; }
    .section h3 { color: #2980b9; margin-bottom: 15px; font-size: 1.2em; font-weight: 600; }
    .question-item { margin-bottom: 20px; }
    .question-label { display: block; font-weight: 600; color: #34495e; margin-bottom: 10px; font-size: 1.02em; }
    .required { color: #e74c3c; }
    .optional { color: #95a5a6; font-size: 0.9em; font-weight: 400; }
    .form-control { width: 100%; padding: 15px; border: 2px solid #ecf0f1; border-radius: 12px; font-size: 16px; font-family: inherit; transition: all 0.3s ease; background: #fff; }
    .form-control:focus { outline: none; border-color: #3498db; box-shadow: 0 0 0 4px rgba(52,152,219,0.15); transform: translateY(-2px); }
    textarea.form-control { min-height: 120px; resize: vertical; line-height: 1.5; }
    .project-name-input { background: #fff9e6; border-color: #f39c12; margin-top: 10px; }
    .project-name-input:focus { border-color: #f39c12; box-shadow: 0 0 0 4px rgba(243,156,18,0.15); }
    .tip { background: linear-gradient(45deg, #e8f4fd, #f0f8ff); border-left: 4px solid #3498db; padding: 12px 16px; margin-top: 12px; font-size: 0.9em; color: #2980b9; border-radius: 0 8px 8px 0; }
    .consent-section { background: linear-gradient(45deg, #fff3cd, #fefbea); border: 2px solid #ffeaa7; border-radius: 12px; padding: 20px; margin: 25px 0; }
    .consent-checkbox { display: flex; gap: 12px; align-items: flex-start; }
    .consent-checkbox input[type="checkbox"] { width: 20px; height: 20px; margin-top: 2px; flex-shrink: 0; }
    .submit-section { text-align: center; margin-top: 35px; }
    .btn-submit { background: linear-gradient(45deg, #27ae60, #2ecc71); color: white; border: none; padding: 18px 35px; font-size: 17px; font-weight: bold; border-radius: 12px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 6px 20px rgba(39,174,96,0.3); min-width: 200px; }
    .btn-submit:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(39,174,96,0.4); }
    .btn-submit:disabled { opacity: 0.6; cursor: not-allowed; transform: none; box-shadow: none; }
    .completion-screen { display: none; text-align: center; padding: 40px 20px; }
    .completion-screen h2 { color: #27ae60; margin-bottom: 15px; font-size: 1.5em; }
    .completion-screen .success-message { background: linear-gradient(45deg, #d5edda, #e8f5e8); border: 2px solid #c3e6cb; border-radius: 12px; padding: 20px; margin: 20px 0; }

    /* Mobil optimizasyon */
    @media (max-width: 768px) {
      body { padding: 10px; }
      .container { padding: 20px; margin: 5px; border-radius: 16px; }
      .header h1 { font-size: 1.4em; }
      .section { padding: 20px; margin-bottom: 25px; }
      .form-control { padding: 12px; font-size: 16px; }
      textarea.form-control { min-height: 100px; }
      .btn-submit { width: 100%; padding: 16px; font-size: 16px; }
      .time-indicator { padding: 8px 16px; font-size: 0.85em; }
      .achievement-badges { gap: 5px; }
      .badge { padding: 6px 10px; font-size: 0.8em; }
    }

    /* Touch-friendly design */
    @media (pointer: coarse) {
      .form-control { padding: 16px; border-width: 3px; }
      .btn-submit { padding: 20px 35px; font-size: 18px; }
      .consent-checkbox input[type="checkbox"] { width: 22px; height: 22px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="survey-form">
      <div class="header">
        <h1>üöÄ Proje Hikayeleri Anketi</h1>
        <p>Ger√ßek deneyimlerinizle proje y√∂netimi kitabƒ±na katkƒ±da bulunun</p>
        <div class="time-indicator">‚è±Ô∏è Sadece 3 dakika</div>
      </div>

      <!-- Progress Indicator -->
      <div class="progress-container">
        <div class="progress-bar-wrapper">
          <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="progress-steps">
          <div class="progress-step active" id="step0">Profil</div>
          <div class="progress-step" id="step1">Ba≈üarƒ±</div>
          <div class="progress-step" id="step2">ƒ∞nsan</div>
          <div class="progress-step" id="step3">Operasyon</div>
          <div class="progress-step" id="step4">Kriz</div>
        </div>
      </div>

      <!-- Achievement Panel -->
      <div class="achievement-panel" id="achievementPanel">
        <div class="achievement-score">üèÜ Hikaye Puanƒ±nƒ±z: <span id="totalScore">0</span>/100</div>
        <div class="achievement-badges">
          <div class="badge" id="badgeProfile">üë§ Profil</div>
          <div class="badge" id="badgeSuccess">üéØ Ba≈üarƒ±</div>
          <div class="badge" id="badgeHuman">üë• ƒ∞nsan</div>
          <div class="badge" id="badgeOps">‚ö° Operasyon</div>
          <div class="badge" id="badgeCrisis">üî• Kriz</div>
        </div>
      </div>

      <!-- Encouragement Messages -->
      <div class="encouragement-message" id="encouragementMsg"></div>

      <div class="multi-submission-note">
        <strong>üìù Not:</strong> Farklƒ± projelerle bu anketi birden √ßok kez doldurabilirsiniz. Her projeniz ayrƒ± deƒüerli hikayeler i√ßeriyor!
      </div>

      <form id="projectSurvey">
        <!-- Kimlik Bilgileri -->
        <div class="section">
          <h3>üë§ ƒ∞leti≈üim Bilgileri</h3>
          <div class="question-item">
            <label class="question-label">Email Adresiniz <span class="optional">(kitap haberleri i√ßin)</span></label>
            <input type="email" class="form-control" name="email" placeholder="ornek@sirket.com" />
          </div>
          <div class="question-item">
            <label class="question-label">Ad Soyad <span class="optional">(kitapta te≈üekk√ºr b√∂l√ºm√ºnde yer alabilir)</span></label>
            <input type="text" class="form-control" name="name" placeholder="Mehmet Yƒ±lmaz" />
          </div>
        </div>

        <!-- Temel Profil -->
        <div class="section">
          <h3>üíº Profiliniz</h3>
          <div class="question-item">
            <label class="question-label">Proje y√∂netimi deneyiminiz <span class="required">*</span></label>
            <select class="form-control" name="experience" required>
              <option value="">Deneyim s√ºrenizi se√ßiniz</option>
              <option value="0-2">0-2 yƒ±l</option>
              <option value="3-5">3-5 yƒ±l</option>
              <option value="6-10">6-10 yƒ±l</option>
              <option value="10+">10+ yƒ±l</option>
            </select>
          </div>
          <div class="question-item">
            <label class="question-label">Hangi sekt√∂rde √ßalƒ±≈üƒ±yorsunuz? <span class="required">*</span></label>
            <select class="form-control" name="sector" required>
              <option value="">Sekt√∂r se√ßiniz</option>
              <option value="mobile">Mobil Uygulama Geli≈ütirme</option>
              <option value="web">Web Geli≈ütirme</option>
              <option value="ai">Yapay Zeka / Machine Learning</option>
              <option value="fintech">Fintech / Finansal Teknoloji</option>
              <option value="defense">Savunma Sanayi</option>
              <option value="ecommerce">E-ticaret</option>
              <option value="healthcare">Saƒülƒ±k</option>
              <option value="other">Diƒüer</option>
            </select>
          </div>
        </div>

        <!-- 1. Ba≈üarƒ± Hikayesi -->
        <div class="section">
          <h3>üéØ En Gurur Duyduƒüunuz Ba≈üarƒ±</h3>
          <div class="question-item">
            <label class="question-label">En gurur duyduƒüunuz proje ba≈üarƒ±nƒ±zƒ± anlatƒ±n <span class="required">*</span></label>
            <textarea class="form-control" name="success_story" placeholder="Hangi projeyle gurur duyuyorsunuz? Nasƒ±l ba≈üardƒ±nƒ±z? Sonu√ßta neler deƒüi≈üti?" required oninput="analyzeStoryQuality(this, 'success')"></textarea>
            <input type="text" class="form-control project-name-input" name="project_name" placeholder="Bu projenin adƒ± neydi? (√∂r: Mobil Banking Uygulamasƒ±, CRM Sistemi)" oninput="updateProgress()" />
            <div class="story-quality-indicator" id="successQuality">
              <div class="quality-score">üìä Hikaye Kalitesi: <span id="successScore">0</span>/20</div>
            </div>
            <div class="tip">üí° ƒ∞yi hikaye i√ßin: Projenin amacƒ± + Zorluklarƒ±nƒ±z + √á√∂z√ºm√ºn√ºz + Sonu√ßlar</div>
          </div>
        </div>

        <!-- 2. ƒ∞nsan Fakt√∂r√º -->
        <div class="section">
          <h3>üë• ƒ∞nsan Dinamikleri</h3>
          <div class="question-item">
            <label class="question-label">Ekip veya insanlarla ya≈üadƒ±ƒüƒ±nƒ±z en zor durumu anlatƒ±n <span class="required">*</span></label>
            <textarea class="form-control" name="human_challenge" placeholder="Ekip √ßatƒ±≈ümasƒ±, kilit ki≈üinin ayrƒ±lmasƒ±, ileti≈üim sorunu, uzaktan √ßalƒ±≈üma zorluklarƒ±... Ne oldu ve nasƒ±l √ß√∂zd√ºn√ºz?" required oninput="analyzeStoryQuality(this, 'human')"></textarea>
            <div class="story-quality-indicator" id="humanQuality">
              <div class="quality-score">üìä Hikaye Kalitesi: <span id="humanScore">0</span>/20</div>
            </div>
            <div class="tip">üí° Odaklanƒ±n: Sorun + Yakla≈üƒ±mƒ±nƒ±z + Sonu√ß + Ne √∂ƒürendiniz</div>
          </div>
        </div>

        <!-- 3. Operasyonel Zorluk -->
        <div class="section">
          <h3>‚ö° Operasyonel Zorluklar</h3>
          <div class="question-item">
            <label class="question-label">Zaman, b√ºt√ße, teknoloji gibi operasyonel zorluklarƒ±nƒ±zƒ± anlatƒ±n <span class="required">*</span></label>
            <textarea class="form-control" name="operational_challenge" placeholder="Deadline baskƒ±sƒ±, b√ºt√ße kƒ±sƒ±tlarƒ±, teknoloji deƒüi≈üimi, kaynak yetersizliƒüi... Hangi zorluklarla kar≈üƒ±la≈ütƒ±nƒ±z ve nasƒ±l ba≈üa √ßƒ±ktƒ±nƒ±z?" required oninput="analyzeStoryQuality(this, 'ops')"></textarea>
            <div class="story-quality-indicator" id="opsQuality">
              <div class="quality-score">üìä Hikaye Kalitesi: <span id="opsScore">0</span>/20</div>
            </div>
            <div class="tip">üí° Detaylandƒ±rƒ±n: Kƒ±sƒ±t + Etkisi + Aldƒ±ƒüƒ±nƒ±z aksiyonlar + Sonu√ß</div>
          </div>
        </div>

        <!-- 4. Kriz Senaryosu -->
        <div class="section">
          <h3>üî• En B√ºy√ºk Kriz Anƒ±nƒ±z</h3>
          <div class="question-item">
            <label class="question-label">Ya≈üadƒ±ƒüƒ±nƒ±z en b√ºy√ºk proje krizini anlatƒ±n <span class="required">*</span></label>
            <textarea class="form-control" name="biggest_crisis" placeholder="Her ≈üey ters giderken neler ya≈üadƒ±nƒ±z? Panik anlarƒ±, kritik kararlar, son dakika √ß√∂z√ºmleri... Krizi nasƒ±l atlattƒ±nƒ±z?" required oninput="analyzeStoryQuality(this, 'crisis')"></textarea>
            <div class="story-quality-indicator" id="crisisQuality">
              <div class="quality-score">üìä Hikaye Kalitesi: <span id="crisisScore">0</span>/20</div>
            </div>
            <div class="tip">üí° Hikaye anlatƒ±n: Krizin ba≈ülangƒ±cƒ± + En zor anlar + √á√∂z√ºm s√ºreci + √áƒ±karƒ±lan dersler</div>
          </div>
        </div>

        <!-- KVKK Onayƒ± -->
        <div class="consent-section">
          <div class="consent-checkbox">
            <input type="checkbox" id="consent" name="consent" required />
            <label for="consent">
              <strong>KVKK ve ƒ∞√ßerik Onayƒ±:</strong> Hikayelerimin kitap √ßalƒ±≈ümasƒ±nda kullanƒ±lmasƒ±na, gerektiƒüinde anonimle≈ütirilerek yayƒ±nlanmasƒ±na ve (istersem) ismimin te≈üekk√ºr b√∂l√ºm√ºnde ge√ßmesine onay veriyorum.
              <a href="#" onclick="showKvkkModal()" style="color: #3498db; font-weight: 600;">Detaylarƒ± oku</a>
            </label>
          </div>
        </div>

        <!-- Submit -->
        <div class="submit-section">
          <button type="submit" class="btn-submit" id="submitBtn" disabled>üìö Hikayelerimi Payla≈ü</button>
          <div style="margin-top: 15px; font-size: 0.9em; color: #7f8c8d; line-height: 1.5;">
            Verileriniz g√ºvenli ≈üekilde kaydedilir<br />Farklƒ± projeler i√ßin tekrar doldurabilirsiniz
          </div>
        </div>
      </form>
    </div>

    <!-- Ba≈üarƒ± Ekranƒ± -->
    <div id="success-screen" class="completion-screen">
      <h2>üôè Hikayeleriniz Kaydedildi!</h2>
      <div class="success-message">
        <p><strong>Te≈üekk√ºr ederiz!</strong></p>
        <p>Deneyimleriniz proje y√∂netimi literat√ºr√ºne deƒüerli katkƒ±lar saƒülayacak.</p>
        <p style="margin-top: 15px;">üìß Sorularƒ±nƒ±z i√ßin: <strong>anket@projegercegi.com</strong></p>
      </div>
      <button onclick="resetForm()" style="padding: 15px 25px; background: linear-gradient(45deg, #3498db, #5dade2); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(52,152,219,0.3);">üîÑ Ba≈üka Proje ƒ∞√ßin Yeni Form Doldur</button>
    </div>
  </div>

  <script>
    // Progress and Gamification System
    let currentProgress = 0;
    let achievementScores = { profile: 0, success: 0, human: 0, ops: 0, crisis: 0 };

    const encouragementMessages = [
      'üî• Harika ba≈ülangƒ±√ß! Devam edin!',
      'üí™ √áok iyi gidiyorsunuz! Hikayeleriniz deƒüerli.',
      'üöÄ S√ºpersiniz! Neredeyse tamamladƒ±nƒ±z.',
      'üèÜ M√ºkemmel! Son adƒ±mdasƒ±nƒ±z!',
      'üéØ Tebrikler! Harika hikayeler yazdƒ±nƒ±z!'
    ];

    const qualityKeywords = {
      solution: ['√ß√∂zd√ºm', '√ß√∂zd√ºk', '√ß√∂z√ºm', 'karar', 'strateji', 'y√∂ntem', 'ba≈üardƒ±m', 'organize', 'koordine'],
      problem: ['problem', 'sorun', 'zorluk', 'kriz', 'ba≈üarƒ±sƒ±z', 'hata', 'gecikm…ô', 'b√ºt√ße', 'deadline'],
      emotion: ['stresli', 'endi≈üeli', 'panik', 'mutlu', 'gurur', 'ba≈üarƒ±', 'zorlandƒ±m', 'korkuttu', 'rahatladƒ±m'],
      team: ['ekip', 'takƒ±m', 'team', '√ßalƒ±≈üan', 'manager', 'lead', 'developer', 'client', 'm√º≈üteri'],
      technical: ['sistem', 'uygulama', 'kod', 'test', 'deploy', 'server', 'database', 'API', 'bug', 'feature']
    };

    function updateProgress() {
      const form = document.getElementById('projectSurvey');
      const formData = new FormData(form);
      let completedSections = 0;

      // Profile section (20 points)
      if (formData.get('experience') && formData.get('sector')) {
        achievementScores.profile = 20;
        earnBadge('Profile');
        completedSections++;
      }

      // Story sections (20 points each)
      const stories = ['success_story', 'human_challenge', 'operational_challenge', 'biggest_crisis'];
      stories.forEach((story) => {
        const value = formData.get(story);
        if (value && value.trim().length > 0) {
          completedSections++;
        }
      });

      currentProgress = (completedSections / 5) * 100;
      document.getElementById('progressBar').style.width = currentProgress + '%';

      // Update step indicators
      for (let i = 0; i <= 4; i++) {
        const step = document.getElementById(`step${i}`);
        if (i < completedSections) step.className = 'progress-step completed';
        else if (i === completedSections) step.className = 'progress-step active';
        else step.className = 'progress-step';
      }

      // Update total score
      const totalScore = Object.values(achievementScores).reduce((sum, score) => sum + score, 0);
      document.getElementById('totalScore').textContent = totalScore;

      // Show encouragement
      if (completedSections > 0 && Math.random() > 0.7) {
        showEncouragement(completedSections - 1);
      }
    }

    function analyzeStoryQuality(textarea, type) {
      const text = textarea.value.toLowerCase();
      let score = 0;

      // Length scoring (0-8 points)
      if (text.length > 500) score += 8;
      else if (text.length > 300) score += 6;
      else if (text.length > 150) score += 4;
      else if (text.length > 50) score += 2;

      // Keyword scoring (0-12 points)
      Object.keys(qualityKeywords).forEach((category) => {
        const found = qualityKeywords[category].filter((word) => text.includes(word)).length;
        if (found > 0) score += Math.min(found * 0.8, 3); // Max 3 points per category
      });

      // Bonus for story structure
      const structureWords = ['√∂nce', 'sonra', 'ardƒ±ndan', 'daha sonra', 'o zaman', 'sonu√ß', '√ß√∂z√ºm', 'karar'];
      const structureCount = structureWords.filter((word) => text.includes(word)).length;
      if (structureCount >= 3) score += 4;
      else if (structureCount >= 1) score += 2;

      score = Math.min(Math.round(score), 20); // Cap at 20
      achievementScores[type] = score;

      // Update UI
      const scoreElement = document.getElementById(`${type}Score`);
      const qualityIndicator = document.getElementById(`${type}Quality`);

      if (scoreElement) {
        scoreElement.textContent = score;
        if (score >= 15) {
          scoreElement.style.color = '#27ae60';
          scoreElement.innerHTML = `${score} ‚≠ê`;
        } else if (score >= 10) {
          scoreElement.style.color = '#f39c12';
          scoreElement.innerHTML = `${score} ‚úì`;
        }
      }

      if (qualityIndicator && text.length > 10) {
        qualityIndicator.style.display = 'block';
      }

      // Earn badges based on quality
      if (score >= 15) {
        earnBadge(type.charAt(0).toUpperCase() + type.slice(1));
      }

      updateProgress();
    }

    function earnBadge(badgeType) {
      const badgeMap = {
        Profile: 'badgeProfile',
        Success: 'badgeSuccess',
        Human: 'badgeHuman',
        Ops: 'badgeOps',
        Crisis: 'badgeCrisis'
      };

      const badgeElement = document.getElementById(badgeMap[badgeType]);
      if (badgeElement && !badgeElement.classList.contains('earned')) {
        badgeElement.classList.add('earned');
        const encouragementElement = document.getElementById('encouragementMsg');
        const messages = {
          Profile: '‚úÖ Bilgiler tamamlandƒ±!',
          Success: 'üéØ Ba≈üarƒ± hikayesi rozetini kazandƒ±nƒ±z!',
          Human: 'üë• ƒ∞nsan dinamikleri rozetini kazandƒ±nƒ±z!',
          Ops: '‚ö° Operasyon rozetini kazandƒ±nƒ±z!',
          Crisis: 'üî• Kriz rozetini kazandƒ±nƒ±z!'
        };
        encouragementElement.textContent = messages[badgeType] || 'Rozet kazandƒ±nƒ±z!';
        encouragementElement.style.display = 'block';
        encouragementElement.style.background = 'linear-gradient(45deg, #27ae60, #2ecc71)';
        setTimeout(() => { encouragementElement.style.display = 'none'; badgeElement.style.animation = 'none'; }, 3000);
      }
    }

    function showEncouragement(level) {
      const encouragementElement = document.getElementById('encouragementMsg');
      if (level < encouragementMessages.length) {
        encouragementElement.innerHTML = encouragementMessages[level];
        encouragementElement.style.display = 'block';
        setTimeout(() => { encouragementElement.style.display = 'none'; }, 3000);
      }
    }

    // --- ‚úÖ YENƒ∞: Submit √∂ncesi t√ºm deƒüerleri yeniden hesapla
    function recomputeAllBeforeSubmit() {
      const map = {
        success_story: 'success',
        human_challenge: 'human',
        operational_challenge: 'ops',
        biggest_crisis: 'crisis'
      };
      Object.keys(map).forEach((name) => {
        const el = document.querySelector(`[name="${name}"]`);
        if (el) analyzeStoryQuality(el, map[name]);
      });
      updateProgress();
      checkFormValidity();
    }

    // Form ge√ßerliliƒüi kontrol√º (enhanced)
    function checkFormValidity() {
      const form = document.getElementById('projectSurvey');
      const required = form.querySelectorAll('[required]');
      const submitBtn = document.getElementById('submitBtn');
      let allValid = true;
      required.forEach((field) => {
        if (field.type === 'checkbox') {
          if (!field.checked) allValid = false;
        } else if (field.tagName === 'TEXTAREA') {
          if (field.value.trim().length === 0) allValid = false;
        } else if (field.tagName === 'SELECT') {
          if (!field.value) allValid = false;
        }
      });
      submitBtn.disabled = !allValid;
      const totalScore = Object.values(achievementScores).reduce((sum, score) => sum + score, 0);
      if (allValid) {
        if (totalScore >= 80) {
          submitBtn.style.background = 'linear-gradient(45deg, #8e44ad, #9b59b6)';
          submitBtn.textContent = 'üèÜ M√ºkemmel Hikayeleri Payla≈ü';
        } else if (totalScore >= 60) {
          submitBtn.style.background = 'linear-gradient(45deg, #27ae60, #2ecc71)';
          submitBtn.textContent = '‚≠ê Kaliteli Hikayeleri Payla≈ü';
        } else {
          submitBtn.style.background = 'linear-gradient(45deg, #3498db, #5dade2)';
          submitBtn.textContent = 'üìö Hikayelerimi Payla≈ü';
        }
      } else {
        submitBtn.style.background = '#95a5a6';
        submitBtn.textContent = 'üìù Formu Tamamlayƒ±n';
      }
    }

    // Event listeners
    document.addEventListener('DOMContentLoaded', function () {
      currentProgress = 20;
      document.getElementById('progressBar').style.width = '20%';
      document.getElementById('step0').className = 'progress-step active';
      document.getElementById('achievementPanel').style.display = 'block';
      document.querySelector('.progress-container').style.display = 'block';

      const requiredFields = document.querySelectorAll('[required]');
      requiredFields.forEach((field) => {
        field.addEventListener('input', () => { checkFormValidity(); updateProgress(); });
        field.addEventListener('change', () => { checkFormValidity(); updateProgress(); });
      });

      const textareas = document.querySelectorAll('textarea');
      textareas.forEach((textarea) => {
        textarea.addEventListener('input', function () {
          this.style.height = 'auto';
          this.style.height = this.scrollHeight + 'px';
        });
      });

      const achievementPanel = document.getElementById('achievementPanel');
      achievementPanel.addEventListener('mouseenter', () => {
        const totalScore = Object.values(achievementScores).reduce((sum, score) => sum + score, 0);
        if (totalScore > 0) achievementPanel.style.transform = 'scale(1.02)';
      });
      achievementPanel.addEventListener('mouseleave', () => { achievementPanel.style.transform = 'scale(1)'; });

      setTimeout(() => { earnBadge('Profile'); updateProgress(); }, 1000);
    });

    // --- ‚úÖ G√úNCEL: Form submit
    document.getElementById('projectSurvey').addEventListener('submit', function (e) {
      e.preventDefault();

      // 1) Submit anƒ±nda t√ºm deƒüerleri yeniden hesapla
      recomputeAllBeforeSubmit();

      const submitBtn = document.getElementById('submitBtn');
      submitBtn.textContent = 'üöÄ G√∂nderiliyor...';
      submitBtn.disabled = true;

      // 2) Form verilerini topla
      const formData = new FormData(this);
      const responses = {};
      for (let [key, value] of formData.entries()) {
        responses[key] = typeof value === 'string' ? value.trim() : value;
      }

      // 3) Gamification verileri
      const totalScore = Object.values(achievementScores).reduce((sum, score) => sum + score, 0);
      responses.submission_date = new Date().toLocaleString('tr-TR');
      responses.version = 'gamified_v3.0_fixed';
      responses.total_quality_score = totalScore;
      responses.section_scores = JSON.stringify(achievementScores);
      responses.completion_percentage = currentProgress;
      responses.earned_badges = Array.from(document.querySelectorAll('.badge.earned')).length;
      responses.user_agent = navigator.userAgent;
      responses.form_language = 'turkish';

      // 4) Google Sheets i√ßin alias alanlar
      const alias = {
        full_name: responses.full_name || responses.name || '',
        email_address: responses.email_address || responses.email || '',
        project_name: responses.project_name || '',
        biggest_crisis: responses.biggest_crisis || '',
        success_story: responses.success_story || '',
        human_challenge: responses.human_challenge || '',
        operational_challenge: responses.operational_challenge || ''
      };
      Object.assign(responses, alias);

      // 5) Ek kalite metrikleri
      responses.total_chars = (responses.success_story || '').length + (responses.human_challenge || '').length + (responses.operational_challenge || '').length + (responses.biggest_crisis || '').length;
      responses.quality_score = totalScore;
      responses.quality_indicators = Array.from(document.querySelectorAll('.badge.earned')).map((b) => b.textContent).join(', ');
      responses.consistency_warnings = '';

      console.log('üéØ Gamification verileri:', {
        total_quality_score: responses.total_quality_score,
        section_scores: responses.section_scores,
        completion_percentage: responses.completion_percentage,
        earned_badges: responses.earned_badges,
        project_name: responses.project_name,
        version: responses.version
      });

      // 6) Google Apps Script URL (SENƒ∞N URL'ƒ∞N)
      const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyJS-muCjXuDKIjfRuO-ss3BLSQO6eWy2HpKQ-B7lweljeIZki8B0dC4Ftt3Nfk3m1t/exec';

      // --- ‚úÖ G√úNCEL: JSON yerine URL-encoded g√∂nderim (Apps Script ile en uyumlusu)
      // responses objesini hazƒ±rladƒ±ktan sonra:
      const params = new URLSearchParams();
      Object.entries(responses).forEach(([k, v]) => params.append(k, String(v ?? '')));

      fetch(GOOGLE_SCRIPT_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' },
      body: params.toString()
       });      

      // 7) Ba≈üarƒ± ekranƒ±nƒ± g√∂ster
      setTimeout(() => {
        document.getElementById('survey-form').style.display = 'none';
        const successScreen = document.getElementById('success-screen');
        successScreen.style.display = 'block';
        const ts = totalScore;
        if (ts >= 80) {
          successScreen.innerHTML = `
            <h2>üèÜ M√ºkemmel! ${ts}/100 Puan!</h2>
            <div class="success-message">
              <p><strong>Hikaye Ustasƒ±!</strong></p>
              <p>Yazdƒ±ƒüƒ±nƒ±z hikayeler √ßok kaliteli. Kitapta √∂zel bir yere sahip olacaklar.</p>
              <p style="margin-top: 15px;">üìß Sorularƒ±nƒ±z i√ßin: <strong>anket@projegercegi.com</strong></p>
            </div>
            <button onclick="resetForm()" style="padding: 15px 25px; background: linear-gradient(45deg, #8e44ad, #9b59b6); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(142,68,173,0.3);">üî• Ba≈üka Proje ƒ∞√ßin Yeni Form Doldur</button>
          `;
        } else if (ts >= 60) {
          successScreen.innerHTML = `
            <h2>‚≠ê Harika! ${ts}/100 Puan!</h2>
            <div class="success-message">
              <p><strong>√áok iyi hikayeler!</strong></p>
              <p>Deneyimleriniz proje y√∂netimi literat√ºr√ºne deƒüerli katkƒ±lar saƒülayacak.</p>
              <p style="margin-top: 15px;">üìß Sorularƒ±nƒ±z i√ßin: <strong>anket@projegercegi.com</strong></p>
            </div>
            <button onclick="resetForm()" style="padding: 15px 25px; background: linear-gradient(45deg, #27ae60, #2ecc71); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(39,174,96,0.3);">‚ú® Ba≈üka Proje ƒ∞√ßin Yeni Form Doldur</button>
          `;
        }
        window.scrollTo(0, 0);
      }, 800);
    });

    // Form sƒ±fƒ±rlama
    function resetForm() {
      document.getElementById('survey-form').style.display = 'block';
      document.getElementById('success-screen').style.display = 'none';
      document.getElementById('projectSurvey').reset();

      currentProgress = 0;
      achievementScores = { profile: 0, success: 0, human: 0, ops: 0, crisis: 0 };

      document.getElementById('progressBar').style.width = '0%';
      document.getElementById('totalScore').textContent = '0';

      document.querySelectorAll('.badge').forEach((b) => b.classList.remove('earned'));
      document.querySelectorAll('.story-quality-indicator').forEach((i) => (i.style.display = 'none'));

      for (let i = 0; i <= 4; i++) {
        const step = document.getElementById(`step${i}`);
        step.className = i === 0 ? 'progress-step active' : 'progress-step';
      }

      const textareas = document.querySelectorAll('textarea');
      textareas.forEach((t) => (t.style.height = 'auto'));

      checkFormValidity();
      window.scrollTo(0, 0);
    }

    function showKvkkModal() {
      alert(`KVKK Aydƒ±nlatma Metni ve ƒ∞√ßerik Onayƒ±:\n\nToplanan Veriler: Ad-soyad, e-posta ve proje hikayeleriniz\nAma√ß: Proje Ger√ßeƒüi kitabƒ±nƒ±n hazƒ±rlanmasƒ±\nƒ∞≈üleme: Hikayeleriniz anonimle≈ütirilerek kitapta kullanƒ±labilir\nSaklama: Kitap tamamlanana kadar g√ºvenli ≈üekilde saklanƒ±r\nHaklarƒ±nƒ±z: Dilediƒüiniz zaman verilerinizin silinmesini talep edebilirsiniz\n\nƒ∞leti≈üim: anket@projegercegi.com\n\nBu onayƒ± vererek hikayelerinizin kitap projesi kapsamƒ±nda kullanƒ±lmasƒ±na izin vermi≈ü olursunuz.`);
    }

    // Mobil scroll optimize
    let lastScrollTop = 0;
    window.addEventListener('scroll', function () {
      const st = window.pageYOffset || document.documentElement.scrollTop;
      const header = document.querySelector('.header');
      const achievementPanel = document.getElementById('achievementPanel');
      if (st > lastScrollTop && st > 100) {
        header.style.transform = 'translateY(-10px)';
        header.style.opacity = '0.9';
        achievementPanel.style.position = 'sticky';
        achievementPanel.style.top = '10px';
        achievementPanel.style.zIndex = '100';
      } else {
        header.style.transform = 'translateY(0)';
        header.style.opacity = '1';
        achievementPanel.style.position = 'relative';
        achievementPanel.style.top = 'auto';
      }
      lastScrollTop = st <= 0 ? 0 : st;
    }, false);
  </script>
</body>
</html>
